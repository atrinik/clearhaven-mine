FILES = Makefile.in update_rp mktable.script \
	flushlocks atrinik-loop.c atrinikloop.in

SRCS = \
	atrinik-loop.c

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@

OBJS = $(SRCS:.c=.o)

CFLAGS = @CFLAGS@ $(EXTRA_CFLAGS)

LIBS = @LIBS@ $(EXTRA_LIBS)

INSTALL = @INSTALL@

MKDIR = @MKDIR@
SHELL = @BOURNE_SHELL@
CC = @CC@
RM = @RM@

atrinik_loop: $(OBJS)
	$(RM) -f $@
	$(CC) -o $@ $(OBJS) $(LIBS)
	chmod 755 atrinikloop

all: atrinik_loop

depend::
	$(DEPEND) $(DEPENDFLAGS) -- $(ALLDEFINES) $(DEPEND_DEFINES) -- $(SRCS)

install:
	@if [ ! -d $(bindir) ]; then \
		$(MKDIR) -p $(bindir); \
	fi
	rm -f $(bindir)/flushlocks
	sed s%xxxx%$(libdir)%g <flushlocks > $(bindir)/flushlocks
	chmod 755 $(bindir)/flushlocks
	rm -f $(bindir)/dmonloop
	sed s%BINDIR%$(bindir)%g <dmonloop >$(bindir)/dmonloop
	chmod 755 $(bindir)/dmonloop
	$(INSTALL) $(INSTALLFLAGS) mktable.script $(bindir)/mktable

.c.o:
	$(CC) $(CFLAGS) $(INCLUDES) -c $< -o $@

proto::
	
depend::

archive::
	@if [ -d $(ARCHIVE)/utils ]; then set +x; \
	else (set -x; $(MKDIR) $(ARCHIVE)/utils); fi
	$(CP) $(FILES) $(ARCHIVE)/utils

patchlist::
	@echo $(FILES) > .patchlist

clean::
	$(RM) -f atrinik_loop $(OBJS) Makefile.bak

distclean:: clean
	$(RM) -f Makefile $(bindir)/dmonloop $(bindir)/flushlocks $(bindir)/mktable
